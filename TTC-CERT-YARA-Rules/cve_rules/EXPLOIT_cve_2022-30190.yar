/*
YARA Rule Set
Author: TTC-CERT
Date: 2022-06-01
Reference: TLP:WHITE
*/

/* Rule Set ----------------------------------------------------------------- */

rule cve_202230190_Doc_WordXMLRels : Follina
{
	meta:
		version = "1.0"
		first_imported = "2022-06-01"
		last_modified = "2022-06-01"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detects pattern in docx word/_rels/document.xml.rels file used for CVE-2022-30190 exploitation"
		category = "CVE"

	strings:
		$s1 = "<Relationships" ascii nocase
		$s2 = "oleObject" ascii nocase
		$s3 = ".html!\" TargetMode=\"External\"" ascii nocase

	condition:
		filesize < 50KB and
		all of them
}

rule cve_202230190_html_payload : Follina
{
	meta:
		version = "1.0"
		first_imported = "2022-06-01"
		last_modified = "2022-06-01"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detects the HTML file used for CVE-2022-30190 exploitation"
		category = "CVE"

	strings:
		$s1 = "<script" ascii nocase
		$s2 = "window.location.href" ascii nocase
		$s3 = "ms-msdt:" ascii nocase
		$s4 = "IT_RebrowseForFile=" ascii nocase
		$s5 = "../../" ascii
		$s6 = "$(" ascii

	condition:
		filesize >= 4000KB and
		4 of them
}