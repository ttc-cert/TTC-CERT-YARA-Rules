import "pe"

rule apt32_2022_DLL_trojan : T1055 T1218_011
{
	meta:		
		version = "1.0"
		first_imported = "2022-06-21"
		last_modified = "2022-06-21"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source1 = "https://www.ttc-cert.or.th"
		source2 = "https://www.netskope.com/blog/abusing-microsoft-office-using-malicious-web-archive-files"
		author = "TTC-CERT"
		description = "Detect APT32 atefact, aDLL file dropped by malicious MHT file. This DLL file is packed and will be unpack to inject payload into rundll32.exe host process"
		category = "MALWARE"
		malware = "trojan"
		mitre_att = "T1055, T1218.011"
		hash = "974B0F2432608E34AF8AE164895FA952EABFB71B17365223B26E491091C3E447"

	strings:
		$s1 = "glitch.me" wide ascii nocase
		$s2 = "properties.bin" wide ascii nocase
		$s3 = "%systemroot%\\system32\\rundll32.exe" wide ascii nocase
		$s4 = "Computer:" wide ascii
		$s5 = "Program: " wide ascii
		$s6 = "User: " wide ascii
		$arc1 = ".bz2" wide ascii nocase
		$arc2 = ".wim" wide ascii nocase
		$arc3 = ".zip" wide ascii nocase
		$arc4 = ".tar" wide ascii nocase

	condition:
		pe.characteristics & pe.DLL
		and (filesize >= 30MB or filesize <= 70MB)
		and (pe.exports("OpenProfile") or pe.exports("SaveProfile"))
		and 5 of ($s*)
		and 2 of ($arc*)
}