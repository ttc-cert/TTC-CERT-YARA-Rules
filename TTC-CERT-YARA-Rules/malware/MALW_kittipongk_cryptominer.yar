rule kittipongk_cryptominer_XMRig_Unix
{
	meta:
		version = "1.0"
		first_imported = "2021-10-26"
		last_modified = "2021-10-26"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect XMRig crpytominer targeting Unix"
		category = "MALWARE"
		malware = "Cryptominer"
		Malware_focal_SHA256 = "a025a8b424c23856c42dbebcb67ff7c60c6cfd13aa12fcecb15679b98b3ba94d"
		Malware_bionic_SHA256 = "3c1a2e702e7079f9d49373049eff5e59fcf35d526b7a157a4a963fbdf9c7c75f"
		Malware_xenial_SHA256 = "428340a0695393a0cec55513e700a479e252d9b034f27f80a29da3ac99afa459"
		Malware_freebsd_SHA256 = "4fc7113ed150895587635fa58b8be66a32f2d41b06807ac8a9f1898dd1ee6b0c"
		Malware_linuxstatic_SHA256 = "1489c404a110149b66476e0f41317770f0291da64a0d4b39f28900ccaf4d30f2"

	strings:
		$str1 = "xmrig.com" nocase wide ascii
		$str2 = "libxmrig-cuda.so" nocase wide ascii
		$str3 = "cryptonight" nocase wide ascii
		$str4 = "monero" nocase wide ascii
		$hex = {7f 45 4c 46}

	condition:
		3 of ($str*) and
		$hex and
		filesize <= 9MB
}

rule kittipongk_cryptominer_Unix_xmr_stak
{
	meta:
		version = "1.0"
		first_imported = "2021-10-26"
		last_modified = "2021-10-26"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect crpytominer targeting Unix"
		category = "MALWARE"
		malware = "Cryptominer"
		Malware_xmr_stak_SHA256 = "240fe01d9fcce5aae311e906b8311a1975f8c1431b83618f3d11aeaff10aede3"

	strings:
		$str1 = "cryptonote" nocase wide ascii
		$str2 = "lib%s.so" nocase wide ascii
		$str3 = "monero" nocase wide ascii
		$hex = {7f 45 4c 46}

	condition:
		4 of them and
		filesize <= 15MB
}

rule kittipongk_cryptominer_Script_Payload
{
	meta:
		version = "1.0"
		first_imported = "2021-10-26"
		last_modified = "2021-10-26"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect powershell script stg_ntf.ps1 used to download and execute payload"
		category = "MALWARE"
		malware = "Cryptominer"
		SHA256 = "8c1f4f860d085f01b592594cfdba62d6ba3bec72f1452abaa9951989e780d8be"

	strings:
		$str1 = "downloadfile" nocase wide ascii
		$str2 = "ShellExecute" nocase wide ascii
		$str3 = "svconhost.exe" nocase wide ascii
		$str4 = "heuristic-hermann-392016.netlify.app" nocase wide ascii

	condition:
		3 of them and
		filesize <= 1MB
}

rule kittipongk_cryptominer_Shell_Script
{
	meta:
		version = "1.0"
		first_imported = "2021-10-26"
		last_modified = "2021-10-26"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect shell script stg_gh.sh"
		category = "MALWARE"
		malware = "Cryptominer"
		SHA256 = "dd303c2644c2a58cf466a19f7c801aeae43a63d4efd56707f0dd531439d8dafd"

	strings:
		$c2 = "185.199.109.133" nocase wide ascii
		$str1 = "kittipongk" nocase wide ascii
		$str2 = "download_and_run_miner" nocase wide ascii
		$str3 = "$FILE_CC_SERVER" nocase wide ascii
		$str4 = "xmrig" nocase wide ascii
		$ver1 = "focal" nocase wide ascii
		$ver2 = "bionic" nocase wide ascii
		$ver3 = "xenial" nocase wide ascii
		$ver4 = "freebsd" nocase wide ascii
		$ver5 = "linuxstatic" nocase wide ascii

	condition:
		$c2 and
		3 of ($str*) and
		3 of ($ver*) and
		filesize <= 1MB
}

rule kittipongk_cryptominer_Batch_File
{
	meta:
		version = "1.0"
		first_imported = "2021-10-26"
		last_modified = "2021-10-26"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect Batch File c3.bat"
		category = "MALWARE"
		malware = "Cryptominer"
		SHA256 = "3b5ffd88a9762c68de551e63243fcc0549e3c31784285b312adf59832f7523ab"

	strings:
		$wallet = "45dT4wkGP93QJHRFJDPYUFJJN6AJRpWnbAkBbD6hbGWA6ruFJJ2ntb858BB1sCNEixDFNqUjbXUt1cq4wjmu3fTBTTPiRW2" wide ascii
		$wallet_s = "%WALLET%" nocase wide ascii
		$str1 = "kittipongk" nocase wide ascii
		$str2 = "xmrig.exe" nocase wide ascii
		$str3 = "echo echo Monero miner is already running" nocase wide ascii
		$exe1 = "c3.exe" nocase wide ascii
		$exe2 = "7za.exe" nocase wide ascii
		$exe3 = "nssm.exe" nocase wide ascii

	condition:
		($wallet or $wallet_s) and
		all of ($str*) and
		2 of ($exe*) and
		filesize <= 2MB
}