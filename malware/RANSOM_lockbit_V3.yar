import "pe"

rule lockbit_v3_packed
{
	meta:		
		version = "1.0"
		first_imported = "2022-07-06"
		last_modified = "2022-07-06"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect Lockbit V3 ransomware packed file. Due to packed condition of this file and lack of unique strings, the detection may result in many false positive, please carefully examine the file when detected"
		category = "MALWARE"
		malware = "ransomware"
		mitre_att = "T1486"
		hash = "80e8defa5377018b093b5b90de0f2957f7062144c83a09a56bba1fe4eda932ce"
		
	strings:
		$a	= { 90 0F 1F 84 00 00 00 00 00 E8 83 FB FF FF 0F 1F 40  }
		
	condition:
		uint16(0) == 0x5A4D
		and (filesize >= 100KB and filesize <= 200KB)
		and $a at pe.entry_point
}

rule lockbit_V3_dropped_file
{
	meta:
		version = "1.0"
		first_imported = "2022-07-07"
		last_modified = "2022-07-07"
		status = "RELEASED"
		sharing = "TLP:WHITE"
		source = "https://www.ttc-cert.or.th"
		author = "TTC-CERT"
		description = "Detect Lockbit V3 ransomware dropped file (.tmp) in %ProgramData%"
		category = "MALWARE"
		malware = "ransomware"
		mitre_att = "T1486"
		hash = "917E115CC403E29B4388E0D175CBFAC3E7E40CA1742299FBDB353847DB2DE7C2"
		
	strings:
		$a1 = { 4D DC 46 DD 1F 22 5C 14 F0 0F 98 3E 79 D8 B1 A2 46 }
		$a2 = { 4c 6f 61 64 4d 65 6e 75 }
		$a3 = { 53 65 74 54 65 78 74 43 6f 6c 6f 72 }
		
	condition:
		uint16(0) == 0x5A4D
		and (filesize >= 10KB and filesize <= 30KB)
		and all of them
}
